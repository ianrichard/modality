var Modality=function(){var a="ontouchstart"in document.documentElement,b=new Array,c={html:document.querySelector("html"),modalityScopeContainer:document.querySelector("body")},d=function(){document.addEventListener("click",function(b){a(b,["modality-modal","modality-popover"],function(a){e(a)}),a(b,["modality-close"],function(a){g()}),a(b,["modality-submit"],function(a){i()})}),document.addEventListener("touchmove",function(b){a(b,["modality-obscure","modality-popover-caret","modality-no-scroll"])});var a=function(a,b,c){for(var d=a.target;d.parentNode;){for(var e=0;e<b.length;e++)if(d.hasAttribute(b[e]))return a.preventDefault(),void(c&&c(d));d=d.parentNode}};document.addEventListener("keydown",function(a){var c=b.length;if(c>0){var d=c-1,e={Instance:b[d],index:d},g=a.keyCode;27==g?e.Instance.closeOutside()&&h(e):13==g&&"true"!=f().Instance.getContentElement().getAttribute("modality-prevent-enter-submit")&&i()}}),window.addEventListener("resize",function(a){for(var c in b)b[c].resize()})},e=function(a){l();var d,e=a;d=a.hasAttribute("modality-modal")?"modal":"popover";var f,g=b.length+1;"modal"==d?f=new Modality.Modal({invokingElement:e,componentIndex:g}):"popover"==d&&(f=new Modality.Popover({invokingElement:e})),f&&(f.load(),b.push(f),c.modalityScopeContainer.classList.add("inactive"))},f=function(){var a,c;return c=b.length-1,!!(a=b[c])&&{Instance:a,index:c}},g=function(){var a=f();h(a)},h=function(a){if(a&&!a.Instance.isTransitioning()){a.Instance.close();var d=new CustomEvent("Modality.Close",{bubbles:!0,cancelable:!0});a.Instance.getContentElement().dispatchEvent(d),k(a.index),m()}0==b.length&&c.modalityScopeContainer.classList.remove("inactive")},i=function(){var a=new CustomEvent("Modality.Submit",{bubbles:!0,cancelable:!0});f().Instance.getContentElement().dispatchEvent(a)},j=function(){b.length>0&&(g(),j())},k=function(a){b.splice(a,1)},l=function(){if(c.html.classList.add("modality-html-hidden"),n()&&o()){var b="16px";p()&&(b="17px"),c.html.style.paddingRight=b}a&&(c.html.style.position="fixed")},m=function(){c.html.classList.remove("modality-html-hidden"),o()&&(c.html.style.paddingRight=""),a&&(c.html.style.position="")},n=function(){return c.html.scrollHeight>c.html.clientHeight||c.html.scrollWidth>c.html.clientWidth},o=function(){return-1!=navigator.appVersion.indexOf("Win")},p=function(){var a=window.navigator.userAgent,b=a.indexOf("MSIE ");if(b>0)return parseInt(a.substring(b+5,a.indexOf(".",b)),10);if(a.indexOf("Trident/")>0){var c=a.indexOf("rv:");return parseInt(a.substring(c+3,a.indexOf(".",c)),10)}var d=a.indexOf("Edge/");return d>0&&parseInt(a.substring(d+5,a.indexOf(".",d)),10)};!function(){d()}();return{getHighestComponent:f,closeHighestComponent:g,closeEverything:j}}();Modality.Content=function(config){var _dom={invokingElement:config.invokingElement,targetContainer:config.targetContainer,sourceContent:null,sourceContentParentContainer:null,interstitial:null};config.ajaxInjectDelay=config.ajaxInjectDelay||300;var _contentAttributes={},_getContentAttributes=function(){_contentAttributes.contentReference=_dom.invokingElement.getAttribute("href")||_dom.invokingElement.getAttribute("modality-content"),"#"!=_contentAttributes.contentReference.charAt(0)&&"."!=_contentAttributes.contentReference.charAt(0)&&"["!=_contentAttributes.contentReference.charAt(0)?_contentAttributes.contentType="ajax":_contentAttributes.contentType="dom",_dom.invokingElement.hasAttribute("modality-content-copy")||"ajax"==_contentAttributes.contentType?_contentAttributes.contentSourceAction="copy":_contentAttributes.contentSourceAction="move"},_load=function(){if(_getContentAttributes(),"dom"==_contentAttributes.contentType)_dom.sourceContent=document.querySelector(_contentAttributes.contentReference),"copy"==_contentAttributes.contentSourceAction?(_dom.sourceContent=_dom.sourceContent.cloneNode(!0),_dom.sourceContent.setAttribute("id","")):"move"==_contentAttributes.contentSourceAction&&(_dom.sourceContentParentContainer=_dom.sourceContent.parentNode),_dom.targetContainer.appendChild(_dom.sourceContent),_runCallback(config.postLoadCallback);else if("ajax"==_contentAttributes.contentType){_dom.interstitial=document.createElement("div"),_dom.interstitial.className="modality-interstitial",_dom.targetContainer.appendChild(_dom.interstitial);var a=new XMLHttpRequest;a.open("GET",_contentAttributes.contentReference,!0),a.onload=function(){if(a.status>=200&&a.status<400){var b=a.responseText;setTimeout(function(){_dom.interstitial.parentNode.removeChild(_dom.interstitial),_dom.targetContainer.innerHTML=b,_runCallback(config.postLoadCallback)},config.ajaxInjectDelay)}else _handleAjaxFailure()},a.onerror=function(){_handleAjaxFailure()},a.send()}else console.log("Invalid modality setup")},_handleAjaxFailure=function(){setTimeout(function(){_dom.interstitial.parentNode.removeChild(_dom.interstitial),_dom.targetContainer.innerHTML="<h1>Well this is embarassing... The content didn't load</h1>",_runCallback(config.postLoadCallback)},config.ajaxInjectDelay)},_runCallback=function(callback){callback&&("function"==typeof callback?callback():eval(callback))},_unload=function(){"move"==_contentAttributes.contentSourceAction?_dom.sourceContentParentContainer.appendChild(_dom.sourceContent):_dom.sourceContent.parentNode.removeChild(_dom.sourceContent)};return{load:_load,unload:_unload}},Modality.Modal=function(config){var _defaultModalAttributes={height:"auto",maxWidth:800,fadeInDuration:300,fadeOutDuration:300,closeOutside:!0,scaleSelector:void 0},_dom={scaleContainer:null,invokingElement:config.invokingElement,modalScopeContainer:null,modal:null,modalContent:null},_modalAttributes={},_modalIsTransitioning=!1,_documentWidth,_documentHeight,_documentPadding=.03,_paddedDocumentRegion,_rootLevelComponent=!1;1==config.componentIndex&&(_rootLevelComponent=!0);var _ModalContent,_lastFocusedInnerElement,_modalSnapshot={},_loadModal=function(){_checkAndSetTransitioningFlag(),_getModalAttributes(),_runCallback(_modalAttributes.preLoadCallback),_getModalScopeContainer(),_injectModalTemplate(),_setScopedSelectors(),_getDocumentSize(),_getPaddedDocumentRegion(),_loadModalContent(),_broadcastPreLoadEvent(),_setDefaultModalDisplayProperties(),_positionModalContent(),_showModal(),_setGenericEventListeners(),_setModalSnapshot()},_checkAndSetTransitioningFlag=function(){_modalIsTransitioning||(_modalIsTransitioning=!0)},_getModalAttributes=function(){_modalAttributes={},_modalAttributes.height=_dom.invokingElement.getAttribute("modality-height"),_modalAttributes.maxWidth=_dom.invokingElement.getAttribute("modality-max-width"),_modalAttributes.fadeInDuration=_dom.invokingElement.getAttribute("modality-fade-in-duration"),_modalAttributes.fadeOutDuration=_dom.invokingElement.getAttribute("modality-fade-out-duration"),_modalAttributes.closeOutside=_dom.invokingElement.getAttribute("modality-close-outside"),_modalAttributes.preLoadCallback=_dom.invokingElement.getAttribute("modality-pre-load-callback"),_modalAttributes.postCloseCallback=_dom.invokingElement.getAttribute("modality-post-close-callback"),_modalAttributes.scaleSelector=_dom.invokingElement.getAttribute("modality-background-scale");for(attribute in _modalAttributes){var a=_modalAttributes[attribute];"function"!=typeof a&&(a&&a.replace(/\s/g,"").length?"width"!=attribute&&"height"!=attribute&&a.match(/\d+/g)&&(a=Number(a)):a=void 0),_modalAttributes[attribute]=a}"false"==_modalAttributes.closeOutside&&(_modalAttributes.closeOutside=!1),_modalAttributes=_extend(_defaultModalAttributes,_modalAttributes)},_getModalScopeContainer=function(){_dom.modalScopeContainer=null,_dom.modalScopeContainer=document.querySelector("body > *")},_injectModalTemplate=function(){_dom.modal=document.createElement("div"),_dom.modal.className="modality-modal",_dom.modal.innerHTML='<div class="modality-modal-obscure" modality-obscure onclick=""></div><div class="modality-modal-container"><div class="modality-modal-content" modality-modal-content tabindex="0"></div></div>',_modalAttributes.closeOutside&&_dom.modal.querySelector("[modality-obscure]").setAttribute("modality-close",""),_dom.modalScopeContainer.parentNode.appendChild(_dom.modal)},_setScopedSelectors=function(){_dom.scaleContainer=document.querySelector(_modalAttributes.scaleSelector),_dom.modalContent=_dom.modal.querySelector("[modality-modal-content]")},_loadModalContent=function(){_ModalContent=new Modality.Content({invokingElement:_dom.invokingElement,targetContainer:_dom.modalContent}),_ModalContent.load()},_broadcastPreLoadEvent=function(){var a=new CustomEvent("Modality.PreLoad",{bubbles:!0,cancelable:!0});_getContentElement().dispatchEvent(a)},_broadcastPostLoadEvent=function(){var a=new CustomEvent("Modality.PostLoad",{bubbles:!0,cancelable:!0});_getContentElement().dispatchEvent(a)},_setDefaultModalDisplayProperties=function(){_dom.modal.style.display=""},_positionModalContent=function(){if(_dom.modalContentInner=_dom.modalContent.firstChild,_dom.modalContentInner){var a=_dom.modalContentInner.scrollTop,b=_modalAttributes.maxWidth;b>_paddedDocumentRegion.width&&(b=_paddedDocumentRegion.width),_dom.modalContentInner.style.height="auto",_dom.modalContent.style.height=_modalAttributes.height+"px",_dom.modalContent.style.width=b+"px",_dom.modalContent.style.maxWidth=b+"px",_dom.modalContent.style.maxHeight=_paddedDocumentRegion.height+"px",_dom.modalContent.style.marginLeft=-_dom.modalContent.offsetWidth/2+"px",_dom.modalContent.style.marginTop=-_dom.modalContent.offsetHeight/2+"px",_dom.modalContentInner.scrollTop=a}},_showModal=function(){setTimeout(function(){_modalIsTransitioning=!1,_rootLevelComponent&&_dom.scaleContainer&&_dom.scaleContainer.classList.add("modality-modal-background-blur"),_broadcastPostLoadEvent()},_modalAttributes.fadeInDuration),_dom.modal.classList.add("modality-modal-active"),_dom.modalContent.focus()},_closeModal=function(){_modalIsTransitioning||(_modalIsTransitioning=!0,_dom.invokingElement.focus(),_rootLevelComponent&&_dom.scaleContainer&&_dom.scaleContainer.classList.remove("modality-modal-background-blur"),_dom.modal.classList.remove("modality-modal-active"),setTimeout(function(){_dom.modal.style.display="none",_modalIsTransitioning=!1,_ModalContent.unload(),_dom.modal.parentNode.removeChild(_dom.modal),_runCallback(_modalAttributes.postCloseCallback)},_modalAttributes.fadeOutDuration))},_getDocumentSize=function(){_documentWidth=window.innerWidth,_documentHeight=window.innerHeight},_getPaddedDocumentRegion=function(){_paddedDocumentRegion={},_paddedDocumentRegion.top=.03*_documentHeight,_paddedDocumentRegion.bottom=_documentHeight-_paddedDocumentRegion.top,_paddedDocumentRegion.left=.03*_documentWidth,_paddedDocumentRegion.right=_documentWidth-_paddedDocumentRegion.left,_paddedDocumentRegion.width=_documentWidth-2*_paddedDocumentRegion.left,_paddedDocumentRegion.height=_documentHeight-2*_paddedDocumentRegion.top},_runCallback=function(callback){callback&&("function"==typeof callback?callback():eval(callback))},_modalIsShowing=function(){return void 0!=_dom.modal&&"none"!==_dom.modal.style.display},_closeOutside=function(){return _modalAttributes.closeOutside},_isTransitioning=function(){return _modalIsTransitioning},_resize=function(){_getDocumentSize(),_documentSizeOrModalContentHasChanged()&&(_getPaddedDocumentRegion(),_positionModalContent(),_setModalSnapshot())},_setModalSnapshot=function(){_modalSnapshot.documentWidth=_documentWidth,_modalSnapshot.documentHeight=_documentHeight,_modalSnapshot.contentHeight=_dom.modalContent.offsetHeight},_documentSizeOrModalContentHasChanged=function(){return(_documentWidth!=_modalSnapshot.documentWidth||_documentHeight!=_modalSnapshot.documentHeight||_dom.modalContent.offsetHeight!=_modalSnapshot.contentHeight)&&(_setModalSnapshot(),!0)},_setGenericEventListeners=function(){var a=window.MutationObserver||window.WebKitMutationObserver||null;if(a){new a(function(a,b){_modalIsShowing&&_resize()}).observe(_dom.modalContent.firstChild,{subtree:!0,attributes:!0})}},_getContentElement=function(){return _dom.modal.querySelector("[modality-modal-content] > *")},_extend=function(a,b){var c=a;for(var d in b)b[d]&&(c[d]=b[d]);return c};return{componentName:"Modal",load:_loadModal,close:_closeModal,closeOutside:_closeOutside,isTransitioning:_isTransitioning,resize:_resize,getContentElement:_getContentElement}},Modality.Popover=function(config){var _dom={invokingElement:config.invokingElement,popoverScopeContainer:null,popover:null,popoverContainer:null,popoverContentInner:null,popoverCaret:null},_defaultPopoverAttributes={width:300,height:"auto",minimumHeight:100,fadeInDuration:300,fadeOutDuration:300,closeOutside:!0,popoverPosition:"vertical",minimumCaretContainerOffset:15},_documentLeftRightPadding=0,_documentTopBottomPadding=0,_popoverIsTransitioning=!1,_popoverAttributes={},_invokingElementAttributes={},_paddedDocumentRegion={},_regionsAroundTheInvokingLink={},_bestRegionForThePopover={},_documentWidth,_documentHeight,_showCaret=!0,_contentIsLoaded=!1,_PopoverContent,_lastFocusedInnerElement,_popoverSnapshot={},_loadPopover=function(){_checkAndSetTransitioningFlag(),_getPopoverAttributes(),_runCallback(_popoverAttributes.preLoadCallback),_getPopoverScopeContainer(),_getInvokingElementAttributes(),_injectPopoverTemplate(),_setScopedSelectors(),_getDocumentSize(),_getPaddedDocumentRegion(),_getRegionsAroundTheInvokingLink(),_getBestRegionForThePopover(),_loadPopoverContent(),_broadcastPreLoadEvent(),_setHiddenDefaultPopoverDisplayProperties(),_positionPopoverContent(),_setCaretPosition(),_showPopover(),_setGenericEventListeners()},_checkAndSetTransitioningFlag=function(){_popoverIsTransitioning||(_popoverIsTransitioning=!0)},_clearTransitioningFlag=function(){_popoverIsTransitioning=!1},_getPopoverAttributes=function(){_popoverAttributes={},_popoverAttributes.width=_dom.invokingElement.getAttribute("modality-width"),_popoverAttributes.height=_dom.invokingElement.getAttribute("modality-height"),_popoverAttributes.minimumHeight=_dom.invokingElement.getAttribute("modality-minimum-height"),_popoverAttributes.fadeInDuration=_dom.invokingElement.getAttribute("modality-fade-in-duration"),_popoverAttributes.fadeOutDuration=_dom.invokingElement.getAttribute("modality-fade-out-duration"),_popoverAttributes.closeOutside=_dom.invokingElement.getAttribute("modality-close-outside"),_popoverAttributes.popoverPosition=_dom.invokingElement.getAttribute("modality-position"),_popoverAttributes.preLoadCallback=_dom.invokingElement.getAttribute("modality-pre-load-callback"),_popoverAttributes.postCloseCallback=_dom.invokingElement.getAttribute("modality-post-close-callback"),_popoverAttributes.offsetFromInvokingLink=_dom.invokingElement.getAttribute("modality-link-offset")||String(Math.round(15-.25*_dom.invokingElement.offsetHeight));for(attribute in _popoverAttributes){var a=_popoverAttributes[attribute];"function"!=typeof a&&(a&&a.replace(/\s/g,"").length?a.match(/\d+/g)&&(a=Number(a)):a=void 0),_popoverAttributes[attribute]=a}"false"==_popoverAttributes.closeOutside&&(_popoverAttributes.closeOutside=!1),_popoverAttributes=_extend(_defaultPopoverAttributes,_popoverAttributes)},_getInvokingElementAttributes=function(){_dom.popoverScopeContainer.contains(_dom.invokingElement)&&document.body.scrollTop,_invokingElementAttributes.top=_dom.invokingElement.getBoundingClientRect().top,_invokingElementAttributes.bottom=_invokingElementAttributes.top+_dom.invokingElement.offsetHeight,_invokingElementAttributes.left=_dom.invokingElement.getBoundingClientRect().left,_invokingElementAttributes.right=_invokingElementAttributes.left+_dom.invokingElement.offsetWidth,_invokingElementAttributes.width=_dom.invokingElement.offsetWidth,_invokingElementAttributes.height=_dom.invokingElement.offsetHeight,_invokingElementAttributes.horizontalCenter=_invokingElementAttributes.left+_invokingElementAttributes.width/2,_invokingElementAttributes.verticalCenter=_invokingElementAttributes.top+_invokingElementAttributes.height/2},_getPopoverScopeContainer=function(){_dom.popoverScopeContainer=null,_dom.popoverScopeContainer=document.querySelector("body > *")},_injectPopoverTemplate=function(){_dom.popover=document.createElement("div"),_dom.popover.className="modality-popover",_dom.popover.innerHTML='<div class="modality-popover-obscure" modality-obscure onclick=""></div><div class="modality-popover-container" modality-popover-container><div class="modality-popover-caret" modality-popover-caret></div><div class="modality-popover-content" modality-popover-content tabindex="0"></div></div>',_popoverAttributes.closeOutside&&_dom.popover.querySelector("[modality-obscure]").setAttribute("modality-close",""),_dom.popoverScopeContainer.parentNode.appendChild(_dom.popover)},_setScopedSelectors=function(){_dom.popoverContainer=_dom.popover.querySelector("[modality-popover-container]"),_dom.popoverContent=_dom.popover.querySelector("[modality-popover-content]"),_dom.popoverCaret=_dom.popover.querySelector("[modality-popover-caret]")},_getPaddedDocumentRegion=function(){_paddedDocumentRegion={},_paddedDocumentRegion.top=0*_documentHeight,_paddedDocumentRegion.bottom=_documentHeight-_paddedDocumentRegion.top,_paddedDocumentRegion.left=0*_documentWidth,_paddedDocumentRegion.right=_documentWidth-_paddedDocumentRegion.left,_paddedDocumentRegion.width=_documentWidth-2*_paddedDocumentRegion.left,_paddedDocumentRegion.height=_documentHeight-2*_paddedDocumentRegion.top},_getRegionsAroundTheInvokingLink=function(){var a={};a.top=_paddedDocumentRegion.top,a.bottom=_invokingElementAttributes.top,a.left=_paddedDocumentRegion.left,a.right=_paddedDocumentRegion.right,a.width=a.right-a.left,a.height=a.bottom-a.top,a.regionName="top";var b={};b.top=_invokingElementAttributes.bottom,b.bottom=_paddedDocumentRegion.bottom,b.left=_paddedDocumentRegion.left,b.right=_paddedDocumentRegion.right,b.width=b.right-b.left,b.height=b.bottom-b.top,b.regionName="bottom";var c={};c.top=_paddedDocumentRegion.top,c.bottom=_paddedDocumentRegion.bottom,c.left=_paddedDocumentRegion.left,c.right=_invokingElementAttributes.left,c.width=c.right-c.left,c.height=c.bottom-c.top,c.regionName="left";var d={};d.top=_paddedDocumentRegion.top,d.bottom=_paddedDocumentRegion.bottom,d.left=_invokingElementAttributes.right,d.right=_paddedDocumentRegion.right,d.width=d.right-d.left,d.height=d.bottom-d.top,d.regionName="right",_regionsAroundTheInvokingLink.top=a,_regionsAroundTheInvokingLink.bottom=b,_regionsAroundTheInvokingLink.left=c,_regionsAroundTheInvokingLink.right=d},_getBestRegionForThePopover=function(){var a=_popoverAttributes.minimumHeight+_popoverAttributes.offsetFromInvokingLink,b=_popoverAttributes.width+_popoverAttributes.offsetFromInvokingLink,c={},d=function(){c=_regionsAroundTheInvokingLink.top.height>=_regionsAroundTheInvokingLink.bottom.height?_regionsAroundTheInvokingLink.top:_regionsAroundTheInvokingLink.bottom},e=function(){c=_regionsAroundTheInvokingLink.left.width>=_regionsAroundTheInvokingLink.right.width?_regionsAroundTheInvokingLink.left:_regionsAroundTheInvokingLink.right},f=function(){var a=!1;"top"==_bestRegionForThePopover.regionName||"bottom"==_bestRegionForThePopover.regionName?_invokingElementAttributes.horizontalCenter<k?a=!0:_invokingElementAttributes.horizontalCenter>l&&(a=!0):_invokingElementAttributes.verticalCenter>i?a=!0:_invokingElementAttributes.verticalCenter<j&&(a=!0),_showCaret=!a},g=!1,h=!1,i=_paddedDocumentRegion.bottom-_popoverAttributes.minimumCaretContainerOffset,j=_paddedDocumentRegion.top+_popoverAttributes.minimumCaretContainerOffset,k=_paddedDocumentRegion.left+_popoverAttributes.minimumCaretContainerOffset,l=_paddedDocumentRegion.right-_popoverAttributes.minimumCaretContainerOffset;_invokingElementAttributes.verticalCenter>i?g=!0:_invokingElementAttributes.verticalCenter<j&&(g=!0),_invokingElementAttributes.horizontalCenter<k?h=!0:_invokingElementAttributes.horizontalCenter>l&&(h=!0);var m="vertical top bottom".indexOf(_popoverAttributes.popoverPosition)>-1;if(m&&h?m=!1:!m&&g&&(m=!0),m){if("top"==_popoverAttributes.popoverPosition){if(a<=_regionsAroundTheInvokingLink.top.height)return _bestRegionForThePopover=_regionsAroundTheInvokingLink.top,void f()}else if("bottom"==_popoverAttributes.popoverPosition&&a<=_regionsAroundTheInvokingLink.bottom.height)return _bestRegionForThePopover=_regionsAroundTheInvokingLink.bottom,void f();d(),a<=c.height?_bestRegionForThePopover=c:(e(),_bestRegionForThePopover=c)}else{if("left"==_popoverAttributes.popoverPosition){if(b<=_regionsAroundTheInvokingLink.left.width)return _bestRegionForThePopover=_regionsAroundTheInvokingLink.left,void f()}else if("right"==_popoverAttributes.popoverPosition&&b<=_regionsAroundTheInvokingLink.right.width)return _bestRegionForThePopover=_regionsAroundTheInvokingLink.right,void f();e(),b<=c.width?_bestRegionForThePopover=c:(d(),_bestRegionForThePopover=c)}f()},_loadPopoverContent=function(){_PopoverContent=new Modality.Content({invokingElement:_dom.invokingElement,targetContainer:_dom.popoverContent,postLoadCallback:function(){_contentIsLoaded=!0,_resize()},ajaxInjectDelay:_popoverAttributes.fadeInDuration}),_PopoverContent.load()},_broadcastPreLoadEvent=function(){var a=new CustomEvent("Modality.PreLoad",{bubbles:!0,cancelable:!0});_getContentElement().dispatchEvent(a)},_broadcastPostLoadEvent=function(){var a=new CustomEvent("Modality.PostLoad",{bubbles:!0,cancelable:!0});_getContentElement().dispatchEvent(a)},_setHiddenDefaultPopoverDisplayProperties=function(){_dom.popoverContent.style.height=_popoverAttributes.height+"px",_dom.popover.style.css=""},_positionPopoverContent=function(){if(_dom.popoverContentInner=_dom.popoverContent.firstChild,_dom.popoverContentInner){_dom.popoverContentInner.style.height="auto";var a,b,c,d,e,f=_dom.popoverContentInner.scrollTop;"top"==_bestRegionForThePopover.regionName?(a=_popoverAttributes.width,b=_bestRegionForThePopover.width,c=_bestRegionForThePopover.height-_popoverAttributes.offsetFromInvokingLink,d=_bestRegionForThePopover.bottom-_dom.popoverContent.offsetHeight-_popoverAttributes.offsetFromInvokingLink):"bottom"==_bestRegionForThePopover.regionName?(a=_popoverAttributes.width,b=_bestRegionForThePopover.width,c=_bestRegionForThePopover.height-_popoverAttributes.offsetFromInvokingLink,d=_bestRegionForThePopover.top+_popoverAttributes.offsetFromInvokingLink):"left"==_bestRegionForThePopover.regionName?(a=_popoverAttributes.width-_popoverAttributes.offsetFromInvokingLink,b=_bestRegionForThePopover.width-_popoverAttributes.offsetFromInvokingLink,c=_bestRegionForThePopover.height,e=_bestRegionForThePopover.right-_dom.popoverContent.offsetWidth-_popoverAttributes.offsetFromInvokingLink):"right"==_bestRegionForThePopover.regionName&&(a=_popoverAttributes.width-_popoverAttributes.offsetFromInvokingLink,b=_bestRegionForThePopover.width-_popoverAttributes.offsetFromInvokingLink,c=_bestRegionForThePopover.height,e=_bestRegionForThePopover.left+_popoverAttributes.offsetFromInvokingLink),_dom.popoverContent.style.width=a+"px",_dom.popoverContent.style.maxWidth=b+"px",_dom.popoverContent.style.maxHeight=c+"px",e?(_dom.popoverContainer.style.left=e+"px",_setHorizontalPopoverY()):(_dom.popoverContainer.style.top=d+"px",_setVerticalPopoverX()),_dom.popoverContentInner.style.height=_dom.popoverContent.offsetHeight+"px";var g=_dom.popoverContent.offsetHeight,h=Number(_dom.popoverContainer.style.top.split("px")[0]),i=h+g;if(i-1>_paddedDocumentRegion.bottom){_dom.popoverContent.style.maxHeight=_getPaddedDocumentRegion.height+"px",g=_dom.popoverContainer.offsetHeight,i=h+g;var j=_paddedDocumentRegion.bottom-g+"px";_dom.popoverContainer.style.top=j,_showCaret=!1}else _showCaret=!0;_dom.popoverContentInner.style.height="auto",_dom.popoverContentInner.scrollTop=f}},_setVerticalPopoverX=function(){var a=_dom.popoverContent.offsetWidth,b=a/2,c=_invokingElementAttributes.horizontalCenter-b;c<_bestRegionForThePopover.left?c=_bestRegionForThePopover.left:c+a>_bestRegionForThePopover.right&&(c=_bestRegionForThePopover.right-a),c+="px",_dom.popoverContainer.style.left=c},_setHorizontalPopoverY=function(){var a=_dom.popoverContent.offsetHeight,b=a/2,c=_invokingElementAttributes.verticalCenter-b;c<_bestRegionForThePopover.top?c=_bestRegionForThePopover.top:c+a>_bestRegionForThePopover.bottom&&(c=_bestRegionForThePopover.bottom-a),_dom.popoverContainer.style.top=c+"px"},_setCaretPosition=function(){if(!_showCaret)return void _dom.popoverCaret.setAttribute("class","");if(_dom.popoverCaret.setAttribute("class","modality-popover-caret modality-popover-caret-"+_bestRegionForThePopover.regionName),_dom.popoverCaret.style.top="",_dom.popoverCaret.style.left="","top"==_bestRegionForThePopover.regionName||"bottom"==_bestRegionForThePopover.regionName){var a=_invokingElementAttributes.horizontalCenter-_dom.popoverContainer.offsetLeft;_dom.popoverCaret.style.left=a+"px"}else if("left"==_bestRegionForThePopover.regionName||"right"==_bestRegionForThePopover.regionName){var b=_invokingElementAttributes.verticalCenter-_dom.popoverContainer.offsetTop;_dom.popoverCaret.style.top=b+"px"}},_showPopover=function(){_dom.popoverContent.style.height=_popoverAttributes.height+"px",setTimeout(function(){_clearTransitioningFlag(),_broadcastPostLoadEvent()},_popoverAttributes.fadeInDuration),_dom.popover.classList.add("modality-popover-active"),_dom.popoverContent.focus()},_resize=function(){_contentIsLoaded&&(_getDocumentSize(),_documentSizeOrPopoverContentHeightHasChanged()&&(_getInvokingElementAttributes(),_getPaddedDocumentRegion(),_getRegionsAroundTheInvokingLink(),_getBestRegionForThePopover(),_positionPopoverContent(),_setCaretPosition(),_setPopoverSnapshot()))},_setPopoverSnapshot=function(){_popoverSnapshot.documentWidth=_documentWidth,_popoverSnapshot.documentHeight=_documentHeight,_popoverSnapshot.contentHeight=_dom.popoverContent.offsetHeight},_documentSizeOrPopoverContentHeightHasChanged=function(){return _documentWidth!=_popoverSnapshot.documentWidth||_documentHeight!=_popoverSnapshot.documentHeight||_dom.popoverContent.offsetHeight!=_popoverSnapshot.contentHeight},_closePopover=function(){!_popoverIsTransitioning&&_popoverIsShowing&&(_popoverIsTransitioning=!0,_dom.invokingElement.focus(),_dom.popover.classList.remove("modality-popover-active"),_dom.popover.classList.add("modality-popover-closing"),setTimeout(function(){_dom.popover.style.display="none",_popoverIsTransitioning=!1,_PopoverContent.unload(),_dom.popover.parentNode.removeChild(_dom.popover),_runCallback(_popoverAttributes.postCloseCallback)},_popoverAttributes.fadeOutDuration))},_getDocumentSize=function(){_documentWidth=window.innerWidth,_documentHeight=window.innerHeight},_runCallback=function(callback){callback&&("function"==typeof callback?callback():eval(callback))},_popoverIsShowing=function(){return void 0!=_dom.popover&&"none"!==_dom.popover.style.display},_closeOutside=function(){return _popoverAttributes.closeOutside},_isTransitioning=function(){return _popoverIsTransitioning},_setGenericEventListeners=function(){var a=window.MutationObserver||window.WebKitMutationObserver||null;if(a){new a(function(a,b){_popoverIsShowing&&_resize()}).observe(_dom.popoverContent.firstChild,{subtree:!0,attributes:!0})}},_getContentElement=function(){return _dom.popover.querySelector("[modality-popover-content] > *")},_extend=function(a,b){var c=a;for(var d in b)b[d]&&(c[d]=b[d]);return c};return{componentName:"Popover",load:_loadPopover,close:_closePopover,closeOutside:_closeOutside,isTransitioning:_isTransitioning,resize:_resize,getContentElement:_getContentElement}};