var Modality=function(){{var a="ontouchstart"in document.documentElement,b=new Array,c=$("body"),d=function(){$(document).delegate("[modality-modal], [modality-popover]","click",function(a){a.preventDefault(),e($(this))}),$(document).delegate("[modality-close]","click",function(){g()}),$(document).delegate("[modality-submit]","click",function(){i()}),$(document).delegate("[modality-obscure], [modality-popover-caret], [modality-no-scroll]","touchmove",function(a){a.preventDefault()}),$(document).keydown(function(a){var c=b.length;if(c>0){var d=c-1,e={Instance:b[d],index:d},g=a.keyCode;27==g?e.Instance.closeOutside()&&h(e):13==g&&"true"!=$(f().Instance.getContentElement()).attr("modality-prevent-enter-submit")&&i()}}),$(window).resize(function(){for(var a in b)b[a].resize()})},e=function(a){l();var d,e=a;d=a.is("[modality-modal]")?"modal":"popover";var f,g=b.length+1;"modal"==d?f=new Modality.Modal({invokingElement:e[0],componentIndex:g}):"popover"==d&&(f=new Modality.Popover({invokingElement:e[0]})),f&&(f.load(),b.push(f),c.addClass("inactive"))},f=function(){var a,c;return c=b.length-1,a=b[c],a?{Instance:a,index:c}:!1},g=function(){var a=f();h(a)},h=function(a){a&&!a.Instance.isTransitioning()&&(a.Instance.close(),$(a.Instance.getContentElement()).trigger("Modality.Close"),k(a.index),m()),0==b.length&&c.removeClass("inactive")},i=function(){$(f().Instance.getContentElement()).trigger("Modality.Submit")},j=function(){b.length>0&&(g(),j())},k=function(a){b.splice(a,1)},l=function(){if($("html").addClass("modality-html-hidden"),n()&&o()){var b="16px";p()&&(b="17px"),$("html").css("padding-right",b)}a()&&$("html").css("position","fixed")},m=function(){$("html").removeClass("modality-html-hidden"),o()&&$("html").css("padding-right",""),a()&&$("html").css("position","")},n=function(){var a=$("html")[0];return a.scrollHeight>a.clientHeight||a.scrollWidth>a.clientWidth},o=function(){return-1!=navigator.appVersion.indexOf("Win")},p=function(){var a=window.navigator.userAgent,b=a.indexOf("MSIE ");if(b>0)return parseInt(a.substring(b+5,a.indexOf(".",b)),10);var c=a.indexOf("Trident/");if(c>0){var d=a.indexOf("rv:");return parseInt(a.substring(d+3,a.indexOf(".",d)),10)}var e=a.indexOf("Edge/");return e>0?parseInt(a.substring(e+5,a.indexOf(".",e)),10):!1},a=function(){return"ontouchstart"in document.documentElement};!function(){d()}()}return{getHighestComponent:f,closeHighestComponent:g,closeEverything:j}}();Modality.Content=function(config){var _$invokingElement=$(config.invokingElement),_$targetContainer=$(config.targetContainer),_$sourceContent,_$sourceContentParentContainer;config.ajaxInjectDelay=config.ajaxInjectDelay||300;var _contentAttributes={},_getContentAttributes=function(){_contentAttributes.contentReference=_$invokingElement.attr("href"),_contentAttributes.contentType="#"!=_contentAttributes.contentReference.charAt(0)&&"."!=_contentAttributes.contentReference.charAt(0)&&"["!=_contentAttributes.contentReference.charAt(0)?"ajax":"dom",_contentAttributes.contentSourceAction=$(this).is("[modality-content-copy]")||"ajax"==_contentAttributes.contentType?"copy":"move"},_load=function(){if(_getContentAttributes(),"dom"==_contentAttributes.contentType)_$sourceContent=$(_contentAttributes.contentReference),"copy"==_contentAttributes.contentSourceAction?(_$sourceContent=_$sourceContent.clone(),_$sourceContent.attr("id",null)):"move"==_contentAttributes.contentSourceAction&&(_$sourceContentParentContainer=_$sourceContent.parent(),_$sourceContent=_$sourceContent.detach()),_$targetContainer.append(_$sourceContent),_runCallback(config.postLoadCallback);else if("ajax"==_contentAttributes.contentType){var a=$('<div class="modality-interstitial" />');_$targetContainer.append(a),$.ajax(_contentAttributes.contentReference).done(function(b){setTimeout(function(){a.remove(),_$sourceContent=$(b),_$targetContainer.append(_$sourceContent),_runCallback(config.postLoadCallback)},config.ajaxInjectDelay)}).fail(function(){setTimeout(function(){a.remove(),_$sourceContent=$("<h1>Well this is embarassing... The content didn't load</h1>"),_$targetContainer.append(_$sourceContent),_runCallback(config.postLoadCallback)},config.ajaxInjectDelay)})}else console.log("Invalid modality setup")},_runCallback=function(callback){callback&&("function"==typeof callback?callback():eval(callback))},_unload=function(){"move"==_contentAttributes.contentSourceAction?(_$sourceContent=_$sourceContent.detach(),_$sourceContentParentContainer.append(_$sourceContent)):(_$sourceContent.remove(),_$sourceContent.unbind())};return{load:_load,unload:_unload}},Modality.Modal=function(config){var _$invokingElement=$(config.invokingElement),_defaultModalAttributes={width:"90%",height:"auto",maxWidth:800,fadeInDuration:300,fadeOutDuration:300,closeOutside:!0,scaleSelector:void 0},_modalAttributes={},_$scaleContainer,_$invokingElement,_$modalScopeContainer,_$modal,_$modalContent,_modalIsTransitioning=!1,_documentWidth,_documentHeight,_documentPadding=.03,_paddedDocumentRegion,_rootLevelComponent=!1;1==config.componentIndex&&(_rootLevelComponent=!0);var _ModalContent,_lastFocusedInnerElement,_modalSnapshot={},_loadModal=function(){_checkAndSetTransitioningFlag(),_getModalAttributes(),_runCallback(_modalAttributes.preLoadCallback),_getModalScopeContainer(),_injectModalTemplate(),_setScopedSelectors(),_getDocumentSize(),_getPaddedDocumentRegion(),_loadModalContent(),_broadcastPreLoadEvent(),_setDefaultModalDisplayProperties(),_positionModalContent(),_showModal(),_setGenericEventListeners(),_setModalSnapshot()},_checkAndSetTransitioningFlag=function(){_modalIsTransitioning||(_modalIsTransitioning=!0)},_getModalAttributes=function(){_modalAttributes={},_modalAttributes.width=_$invokingElement.attr("modality-width"),_modalAttributes.height=_$invokingElement.attr("modality-height"),_modalAttributes.maxWidth=_$invokingElement.attr("modality-max-width"),_modalAttributes.fadeInDuration=_$invokingElement.attr("modality-fade-in-duration"),_modalAttributes.fadeOutDuration=_$invokingElement.attr("modality-fade-out-duration"),_modalAttributes.closeOutside=_$invokingElement.attr("modality-close-outside"),_modalAttributes.preLoadCallback=_$invokingElement.attr("modality-pre-load-callback"),_modalAttributes.postCloseCallback=_$invokingElement.attr("modality-post-close-callback"),_modalAttributes.scaleSelector=_$invokingElement.attr("modality-background-scale");for(attribute in _modalAttributes){var a=_modalAttributes[attribute];"function"!=typeof a&&(a&&""!==$.trim(a)?"width"!=attribute&&"height"!=attribute&&a.match(/\d+/g)&&(a=Number(a)):a=void 0),_modalAttributes[attribute]=a}"false"==_modalAttributes.closeOutside&&(_modalAttributes.closeOutside=!1),_modalAttributes=$.extend({},_defaultModalAttributes,_modalAttributes)},_getModalScopeContainer=function(){_$modalScopeContainer=null,_$modalScopeContainer=$("body > *")},_injectModalTemplate=function(){_$modal=$('<div class="modality-modal"><div class="modality-modal-obscure" modality-obscure onclick=""></div><div class="modality-modal-container"><div class="modality-modal-content" modality-modal-content tabindex="0"></div></div></div>'),_modalAttributes.closeOutside&&_$modal.find("[modality-obscure]").attr("modality-close",""),_$modalScopeContainer.parent().append(_$modal)},_setScopedSelectors=function(){_$scaleContainer=$(_modalAttributes.scaleSelector),_$modalContent=_$modal.find("[modality-modal-content]")},_loadModalContent=function(){_ModalContent=new Modality.Content({invokingElement:_$invokingElement[0],targetContainer:_$modalContent[0]}),_ModalContent.load()},_broadcastPreLoadEvent=function(){$(_getContentElement()).trigger("Modality.PreLoad")},_broadcastPostLoadEvent=function(){$(_getContentElement()).trigger("Modality.PostLoad")},_setDefaultModalDisplayProperties=function(){_$modal.show()},_positionModalContent=function(){$modalContentInner=_$modalContent.find("> *");var a=$modalContentInner.scrollTop(),b=_modalAttributes.maxWidth;b>_paddedDocumentRegion.width&&(b=_paddedDocumentRegion.width),$modalContentInner.height("auto"),_$modalContent.css("width",_modalAttributes.width),_$modalContent.css("height",_modalAttributes.height),_$modalContent.css("max-width",b),_$modalContent.css("max-height",_paddedDocumentRegion.height),_$modalContent.css("margin-left",-(_$modalContent.outerWidth()/2)),_$modalContent.css("margin-top",-(_$modalContent.outerHeight()/2)),$modalContentInner.scrollTop(a)},_showModal=function(){setTimeout(function(){_modalIsTransitioning=!1,_rootLevelComponent&&_$scaleContainer.addClass("modality-modal-background-blur"),_broadcastPostLoadEvent()},_modalAttributes.fadeInDuration),_$modal.addClass("modality-modal-active"),_$modalContent.focus()},_closeModal=function(){_modalIsTransitioning||(_modalIsTransitioning=!0,_$invokingElement.focus(),_$modal.find("[component-close]").removeAttr("component-close"),_rootLevelComponent&&_$scaleContainer.removeClass("modality-modal-background-blur"),_$modal.removeClass("modality-modal-active"),setTimeout(function(){_$modal.hide(),_modalIsTransitioning=!1,_ModalContent.unload(),_$modal.remove(),_runCallback(_modalAttributes.postCloseCallback)},_modalAttributes.fadeOutDuration))},_getDocumentSize=function(){_documentWidth=$(window).width(),_documentHeight=$(window).height()},_getPaddedDocumentRegion=function(){_paddedDocumentRegion={},_paddedDocumentRegion.top=_documentHeight*_documentPadding,_paddedDocumentRegion.bottom=_documentHeight-_paddedDocumentRegion.top,_paddedDocumentRegion.left=_documentWidth*_documentPadding,_paddedDocumentRegion.right=_documentWidth-_paddedDocumentRegion.left,_paddedDocumentRegion.width=_documentWidth-2*_paddedDocumentRegion.left,_paddedDocumentRegion.height=_documentHeight-2*_paddedDocumentRegion.top},_runCallback=function(callback){callback&&("function"==typeof callback?callback():eval(callback))},_modalIsShowing=function(){return void 0!=_$modal?_$modal.is(":visible"):!1},_closeOutside=function(){return _modalAttributes.closeOutside},_isTransitioning=function(){return _modalIsTransitioning},_resize=function(){_getDocumentSize(),_documentSizeOrModalContentHasChanged()&&(_getPaddedDocumentRegion(),_positionModalContent(),_setModalSnapshot())},_setModalSnapshot=function(){_modalSnapshot.documentWidth=_documentWidth,_modalSnapshot.documentHeight=_documentHeight,_modalSnapshot.contentHeight=_$modalContent.height()},_documentSizeOrModalContentHasChanged=function(){return _documentWidth!=_modalSnapshot.documentWidth||_documentHeight!=_modalSnapshot.documentHeight||_$modalContent.height()!=_modalSnapshot.contentHeight?(_setModalSnapshot(),!0):!1},_setGenericEventListeners=function(){var a=window.MutationObserver||window.WebKitMutationObserver||null;if(a){var b=new a(function(a,b){_modalIsShowing&&_resize()});b.observe(_$modalContent.find("> *")[0],{subtree:!0,attributes:!0})}else _$modalContent.bind("click",function(a){_resize()}),_$modalContent.keyup(function(a){_lastFocusedInnerElement!==a.target&&_resize(),_lastFocusedInnerElement=a.target,13==a.keyCode&&_resize()})},_getContentElement=function(){return _$modal.find("[modality-modal-content] > *")[0]};return{componentName:"Modal",load:_loadModal,close:_closeModal,closeOutside:_closeOutside,isTransitioning:_isTransitioning,resize:_resize,getContentElement:_getContentElement}},Modality.Popover=function(config){var _$invokingElement=$(config.invokingElement),_defaultPopoverAttributes={width:300,height:"auto",minimumHeight:100,fadeInDuration:300,fadeOutDuration:300,closeOutside:!0,popoverPosition:"vertical",minimumCaretContainerOffset:15},_$popoverScopeContainer,_$popover,_$popoverContainer,_$popoverContent,_$popoverCaret,_$popoverSourceContentParent,_documentLeftRightPadding=0,_documentTopBottomPadding=0,_popoverIsTransitioning=!1,_popoverAttributes={},_invokingElementAttributes={},_paddedDocumentRegion={},_regionsAroundTheInvokingLink={},_bestRegionForThePopover={},_documentWidth,_documentHeight,_showCaret=!0,_contentIsLoaded=!1,_PopoverContent,_lastFocusedInnerElement,_popoverSnapshot={},_loadPopover=function(){_checkAndSetTransitioningFlag(),_getPopoverAttributes(),_runCallback(_popoverAttributes.preLoadCallback),_getPopoverScopeContainer(),_getInvokingElementAttributes(),_injectPopoverTemplate(),_setScopedSelectors(),_getDocumentSize(),_getPaddedDocumentRegion(),_getRegionsAroundTheInvokingLink(),_getBestRegionForThePopover(),_loadPopoverContent(),_broadcastPreLoadEvent(),_setHiddenDefaultPopoverDisplayProperties(),_positionPopoverContent(),_setCaretPosition(),_showPopover(),_setGenericEventListeners()},_checkAndSetTransitioningFlag=function(){_popoverIsTransitioning||(_popoverIsTransitioning=!0)},_clearTransitioningFlag=function(){_popoverIsTransitioning=!1},_getPopoverAttributes=function(){_popoverAttributes={},_popoverAttributes.width=_$invokingElement.attr("modality-width"),_popoverAttributes.height=_$invokingElement.attr("modality-height"),_popoverAttributes.minimumHeight=_$invokingElement.attr("modality-minimum-height"),_popoverAttributes.fadeInDuration=_$invokingElement.attr("modality-fade-in-duration"),_popoverAttributes.fadeOutDuration=_$invokingElement.attr("modality-fade-out-duration"),_popoverAttributes.closeOutside=_$invokingElement.attr("modality-close-outside"),_popoverAttributes.popoverPosition=_$invokingElement.attr("modality-position"),_popoverAttributes.preLoadCallback=_$invokingElement.attr("modality-pre-load-callback"),_popoverAttributes.postCloseCallback=_$invokingElement.attr("modality-post-close-callback"),_popoverAttributes.offsetFromInvokingLink=_$invokingElement.attr("modality-link-offset")||String(Math.round(15-.25*_$invokingElement.outerHeight()));for(attribute in _popoverAttributes){var a=_popoverAttributes[attribute];"function"!=typeof a&&(a&&""!==$.trim(a)?a.match(/\d+/g)&&(a=Number(a)):a=void 0),_popoverAttributes[attribute]=a}"false"==_popoverAttributes.closeOutside&&(_popoverAttributes.closeOutside=!1),_popoverAttributes=$.extend({},_defaultPopoverAttributes,_popoverAttributes)},_getInvokingElementAttributes=function(){var a=0;_$popoverScopeContainer.has(_$invokingElement)&&(a=$(window).scrollTop()),_invokingElementAttributes.top=_$invokingElement.offset().top-a,_invokingElementAttributes.bottom=_invokingElementAttributes.top+_$invokingElement.outerHeight(),_invokingElementAttributes.left=_$invokingElement.offset().left,_invokingElementAttributes.right=_invokingElementAttributes.left+_$invokingElement.outerWidth(),_invokingElementAttributes.width=_$invokingElement.outerWidth(),_invokingElementAttributes.height=_$invokingElement.outerHeight(),_invokingElementAttributes.horizontalCenter=_invokingElementAttributes.left+_invokingElementAttributes.width/2,_invokingElementAttributes.verticalCenter=_invokingElementAttributes.top+_invokingElementAttributes.height/2},_getPopoverScopeContainer=function(){_$popoverScopeContainer=null,_$popoverScopeContainer=$("body > *")},_injectPopoverTemplate=function(){_$popover=$('<div class="modality-popover"><div class="modality-popover-obscure" modality-obscure onclick=""></div><div class="modality-popover-container" modality-popover-container><div class="modality-popover-caret" modality-popover-caret></div><div class="modality-popover-content" modality-popover-content tabindex="0"></div></div></div>'),_popoverAttributes.closeOutside&&_$popover.find("[modality-obscure]").attr("modality-close",""),_$popoverScopeContainer.parent().append(_$popover)},_setScopedSelectors=function(){_$popoverContainer=_$popover.find("[modality-popover-container]"),_$popoverContent=_$popover.find("[modality-popover-content]"),_$popoverCaret=_$popover.find("[modality-popover-caret]")},_getPaddedDocumentRegion=function(){_paddedDocumentRegion={},_paddedDocumentRegion.top=_documentHeight*_documentTopBottomPadding,_paddedDocumentRegion.bottom=_documentHeight-_paddedDocumentRegion.top,_paddedDocumentRegion.left=_documentWidth*_documentLeftRightPadding,_paddedDocumentRegion.right=_documentWidth-_paddedDocumentRegion.left,_paddedDocumentRegion.width=_documentWidth-2*_paddedDocumentRegion.left,_paddedDocumentRegion.height=_documentHeight-2*_paddedDocumentRegion.top},_getRegionsAroundTheInvokingLink=function(){var a={};a.top=_paddedDocumentRegion.top,a.bottom=_invokingElementAttributes.top,a.left=_paddedDocumentRegion.left,a.right=_paddedDocumentRegion.right,a.width=a.right-a.left,a.height=a.bottom-a.top,a.regionName="top";var b={};b.top=_invokingElementAttributes.bottom,b.bottom=_paddedDocumentRegion.bottom,b.left=_paddedDocumentRegion.left,b.right=_paddedDocumentRegion.right,b.width=b.right-b.left,b.height=b.bottom-b.top,b.regionName="bottom";var c={};c.top=_paddedDocumentRegion.top,c.bottom=_paddedDocumentRegion.bottom,c.left=_paddedDocumentRegion.left,c.right=_invokingElementAttributes.left,c.width=c.right-c.left,c.height=c.bottom-c.top,c.regionName="left";var d={};d.top=_paddedDocumentRegion.top,d.bottom=_paddedDocumentRegion.bottom,d.left=_invokingElementAttributes.right,d.right=_paddedDocumentRegion.right,d.width=d.right-d.left,d.height=d.bottom-d.top,d.regionName="right",_regionsAroundTheInvokingLink.top=a,_regionsAroundTheInvokingLink.bottom=b,_regionsAroundTheInvokingLink.left=c,_regionsAroundTheInvokingLink.right=d},_getBestRegionForThePopover=function(){var a=_popoverAttributes.minimumHeight+_popoverAttributes.offsetFromInvokingLink,b=_popoverAttributes.width+_popoverAttributes.offsetFromInvokingLink,c={},d=function(){c=_regionsAroundTheInvokingLink.top.height>=_regionsAroundTheInvokingLink.bottom.height?_regionsAroundTheInvokingLink.top:_regionsAroundTheInvokingLink.bottom},e=function(){c=_regionsAroundTheInvokingLink.left.width>=_regionsAroundTheInvokingLink.right.width?_regionsAroundTheInvokingLink.left:_regionsAroundTheInvokingLink.right},f=function(){var a=!1;"top"==_bestRegionForThePopover.regionName||"bottom"==_bestRegionForThePopover.regionName?_invokingElementAttributes.horizontalCenter<k?a=!0:_invokingElementAttributes.horizontalCenter>l&&(a=!0):_invokingElementAttributes.verticalCenter>i?a=!0:_invokingElementAttributes.verticalCenter<j&&(a=!0),_showCaret=!a},g=!1,h=!1,i=_paddedDocumentRegion.bottom-_popoverAttributes.minimumCaretContainerOffset,j=_paddedDocumentRegion.top+_popoverAttributes.minimumCaretContainerOffset,k=_paddedDocumentRegion.left+_popoverAttributes.minimumCaretContainerOffset,l=_paddedDocumentRegion.right-_popoverAttributes.minimumCaretContainerOffset;_invokingElementAttributes.verticalCenter>i?g=!0:_invokingElementAttributes.verticalCenter<j&&(g=!0),_invokingElementAttributes.horizontalCenter<k?h=!0:_invokingElementAttributes.horizontalCenter>l&&(h=!0);var m=$.inArray(_popoverAttributes.popoverPosition,["vertical","top","bottom"])>-1;if(m&&h?m=!1:!m&&g&&(m=!0),m){if("top"==_popoverAttributes.popoverPosition){if(a<=_regionsAroundTheInvokingLink.top.height)return _bestRegionForThePopover=_regionsAroundTheInvokingLink.top,void f()}else if("bottom"==_popoverAttributes.popoverPosition&&a<=_regionsAroundTheInvokingLink.bottom.height)return _bestRegionForThePopover=_regionsAroundTheInvokingLink.bottom,void f();d(),a<=c.height?_bestRegionForThePopover=c:(e(),_bestRegionForThePopover=c)}else{if("left"==_popoverAttributes.popoverPosition){if(b<=_regionsAroundTheInvokingLink.left.width)return _bestRegionForThePopover=_regionsAroundTheInvokingLink.left,void f()}else if("right"==_popoverAttributes.popoverPosition&&b<=_regionsAroundTheInvokingLink.right.width)return _bestRegionForThePopover=_regionsAroundTheInvokingLink.right,void f();e(),b<=c.width?_bestRegionForThePopover=c:(d(),_bestRegionForThePopover=c)}f()},_loadPopoverContent=function(){_PopoverContent=new Modality.Content({invokingElement:_$invokingElement[0],targetContainer:_$popoverContent[0],postLoadCallback:function(){_contentIsLoaded=!0,_resize()},ajaxInjectDelay:_popoverAttributes.fadeInDuration}),_PopoverContent.load()},_broadcastPreLoadEvent=function(){$(_getContentElement()).trigger("Modality.PreLoad")},_broadcastPostLoadEvent=function(){$(_getContentElement()).trigger("Modality.PostLoad")},_setHiddenDefaultPopoverDisplayProperties=function(){_$popoverContent.css("height",_popoverAttributes.height),_$popover.show()},_positionPopoverContent=function(){var a=_$popoverContent.find("> *"),b=a.scrollTop();a.height("auto");var c,d,e,f,g;"top"==_bestRegionForThePopover.regionName?(c=_popoverAttributes.width,d=_bestRegionForThePopover.width,e=_bestRegionForThePopover.height-_popoverAttributes.offsetFromInvokingLink,f=_bestRegionForThePopover.bottom-_$popoverContent.outerHeight()-_popoverAttributes.offsetFromInvokingLink):"bottom"==_bestRegionForThePopover.regionName?(c=_popoverAttributes.width,d=_bestRegionForThePopover.width,e=_bestRegionForThePopover.height-_popoverAttributes.offsetFromInvokingLink,f=_bestRegionForThePopover.top+_popoverAttributes.offsetFromInvokingLink):"left"==_bestRegionForThePopover.regionName?(c=_popoverAttributes.width-_popoverAttributes.offsetFromInvokingLink,d=_bestRegionForThePopover.width-_popoverAttributes.offsetFromInvokingLink,e=_bestRegionForThePopover.height,g=_bestRegionForThePopover.right-_$popoverContent.outerWidth()-_popoverAttributes.offsetFromInvokingLink):"right"==_bestRegionForThePopover.regionName&&(c=_popoverAttributes.width-_popoverAttributes.offsetFromInvokingLink,d=_bestRegionForThePopover.width-_popoverAttributes.offsetFromInvokingLink,e=_bestRegionForThePopover.height,g=_bestRegionForThePopover.left+_popoverAttributes.offsetFromInvokingLink),_$popoverContent.css("width",c),_$popoverContent.css("max-width",d),_$popoverContent.css("max-height",e),g?(_$popoverContainer.css("left",g),_setHorizontalPopoverY()):(_$popoverContainer.css("top",f),_setVerticalPopoverX()),a.height(_$popoverContent.height());var h=_$popoverContent.height(),i=Number(_$popoverContainer.css("top").split("px")[0]),j=i+h;if(j-1>_paddedDocumentRegion.bottom){_$popoverContent.css("max-height",_paddedDocumentRegion.height),h=_$popoverContainer.height(),j=i+h;var k=_paddedDocumentRegion.bottom-h;_$popoverContainer.css("top",k),_showCaret=!1}else _showCaret=!0;a.height("auto"),a.scrollTop(b)},_setVerticalPopoverX=function(){var a=_$popoverContent.outerWidth(),b=a/2,c=_invokingElementAttributes.horizontalCenter-b;c<_bestRegionForThePopover.left?c=_bestRegionForThePopover.left:c+a>_bestRegionForThePopover.right&&(c=_bestRegionForThePopover.right-a),_$popoverContainer.css("left",c)},_setHorizontalPopoverY=function(){var a=_$popoverContent.outerHeight(),b=a/2,c=_invokingElementAttributes.verticalCenter-b;c<_bestRegionForThePopover.top?c=_bestRegionForThePopover.top:c+a>_bestRegionForThePopover.bottom&&(c=_bestRegionForThePopover.bottom-a),_$popoverContainer.css("top",c)},_setCaretPosition=function(){if(!_showCaret)return void _$popoverCaret.attr("class","");if(_$popoverCaret.attr("class","modality-popover-caret modality-popover-caret-"+_bestRegionForThePopover.regionName),_$popoverCaret.css("top",""),_$popoverCaret.css("left",""),"top"==_bestRegionForThePopover.regionName||"bottom"==_bestRegionForThePopover.regionName){var a=_invokingElementAttributes.horizontalCenter-_$popoverContainer.position().left;_$popoverCaret.css("left",a)}else if("left"==_bestRegionForThePopover.regionName||"right"==_bestRegionForThePopover.regionName){var b=_invokingElementAttributes.verticalCenter-_$popoverContainer.position().top;_$popoverCaret.css("top",b)}},_showPopover=function(){_$popoverContent.css("height",_popoverAttributes.height),setTimeout(function(){_clearTransitioningFlag(),_broadcastPostLoadEvent()},_popoverAttributes.fadeInDuration),_$popover.addClass("modality-popover-active"),_$popoverContent.focus()},_resize=function(){_contentIsLoaded&&(_getDocumentSize(),_documentSizeOrPopoverContentHeightHasChanged()&&(_getInvokingElementAttributes(),_getPaddedDocumentRegion(),_getRegionsAroundTheInvokingLink(),_getBestRegionForThePopover(),_positionPopoverContent(),_setCaretPosition(),_setPopoverSnapshot()))},_setPopoverSnapshot=function(){_popoverSnapshot.documentWidth=_documentWidth,_popoverSnapshot.documentHeight=_documentHeight,_popoverSnapshot.contentHeight=_$popoverContent.height()},_documentSizeOrPopoverContentHeightHasChanged=function(){return _documentWidth!=_popoverSnapshot.documentWidth||_documentHeight!=_popoverSnapshot.documentHeight||_$popoverContent.height()!=_popoverSnapshot.contentHeight?!0:!1},_closePopover=function(){!_popoverIsTransitioning&&_popoverIsShowing&&(_popoverIsTransitioning=!0,_$invokingElement.focus(),_$popover.find("[component-close]").removeAttr("component-close"),_$popover.removeClass("modality-popover-active"),_$popover.addClass("modality-popover-closing"),setTimeout(function(){_$popover.hide(),_popoverIsTransitioning=!1,_PopoverContent.unload(),_$popover.remove(),_runCallback(_popoverAttributes.postCloseCallback)},_popoverAttributes.fadeOutDuration))},_getDocumentSize=function(){_documentWidth=$(window).width(),_documentHeight=$(window).height()},_runCallback=function(callback){callback&&("function"==typeof callback?callback():eval(callback))},_popoverIsShowing=function(){return void 0!=_$popover?_$popover.is(":visible"):!1},_closeOutside=function(){return _popoverAttributes.closeOutside},_isTransitioning=function(){return _popoverIsTransitioning},_setGenericEventListeners=function(){var a=window.MutationObserver||window.WebKitMutationObserver||null;if(a){var b=new a(function(a,b){_popoverIsShowing&&_resize()});b.observe(_$popoverContent.find("> *")[0],{subtree:!0,attributes:!0})}else _$popoverContent.bind("click",function(a){_resize()}),_$popoverContent.keyup(function(a){_lastFocusedInnerElement!==a.target&&_resize(),_lastFocusedInnerElement=a.target,13==a.keyCode&&_resize()})},_getContentElement=function(){return _$popover.find("[modality-popover-content] > *")[0]};return{componentName:"Popover",load:_loadPopover,close:_closePopover,closeOutside:_closeOutside,isTransitioning:_isTransitioning,resize:_resize,getContentElement:_getContentElement}};